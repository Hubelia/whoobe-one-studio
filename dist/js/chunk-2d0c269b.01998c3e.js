(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c269b"],{"49cc":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-screen",on:{contextmenu:function(t){return e.contextmenu(t)}}},[n("div",{staticClass:"absolute top-0 h-10 w-full flex items-center justify-center text-gray-300 pr-8"},[n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"laptop",title:"fullscreen"},on:{click:function(t){e.mode="fullscreen"}}}),n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"tablet",title:"tablet"},on:{click:function(t){e.mode="tablet"}}}),n("m-icon",{staticClass:"text-2xl  mr-4",attrs:{icon:"smartphone",title:"smartphone"},on:{click:function(t){e.mode="smartphone"}}}),"fullscreen"!=e.mode?n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"flip_camera_android",title:"Change orientation"},on:{click:function(t){e.orientation=!e.orientation}}}):e._e()],1),"fullscreen"===e.mode?n("div",{staticClass:"flex flex-col overflow-y-auto overflow-x-hidden absolute inset-0 mt-10 laptop-view"},[e.doc?n("BlockContainerPrvw",{key:e.doc.id,attrs:{doc:e.doc,id:"content"}}):e._e()],1):e._e(),"fullscreen"!=e.mode?n("div",{staticClass:"text-center text-gray-300",class:"fullscreen"===e.mode?"hidden":""},[n("iframe",{ref:"previewFrame",staticClass:"m-auto border-8 overflow-x-hidden border-black rounded-xl",style:e.previewFrame,attrs:{srcdoc:e.getHTML()}})]):e._e(),n("div",{ref:"contextMenu",staticClass:"fixed z-highest shadow bg-white shadow absolute flex flex-col w-64 cursor-pointer",class:e.classe,on:{mouseleave:function(t){e.display=!e.display}}},[n("div",{staticClass:"p-1 text-white bg-gray-800 flex items-center",on:{click:function(t){e.display=!e.display}}},[e._v(" Options "),n("div",{staticClass:"absolute right-0 mr-1 flex items-center"},[n("m-icon",{attrs:{icon:"close"},on:{click:function(t){e.display=!e.display}}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:function(t){return e.print()}}},[e._v(" Save "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"save"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.pageSettings}},[e._v(" Page settings "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"settings"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.viewHTML}},[e._v(" HTML "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"code"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.buildPage}},[e._v(" Build Page "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"build"}})],1)])]),e.svgString?n("div",[n("img",{attrs:{src:e.svgString}})]):e._e(),e.modal?n("Modal",{attrs:{title:"Preview",topbar:!0,component:"blocks/components/BlockJSEditor.vue",options:e.options},on:{close:function(t){e.modal=!e.modal}}}):e._e()],1)},o=[],s=n("1da1"),r=n("2909"),c=n("5530"),a=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("6062"),n("4de4"),n("a15b"),n("5b81"),n("ac1f"),n("5319"),n("b0c0"),n("2f62")),l=n("52cd"),d=n.n(l),u=n("56d7"),p={name:"BlockWindowPreview",data:function(){return{doc:null,showContextMenu:!1,showHtml:!1,printScreen:!1,editScreenshot:!0,orientation:!1,display:!1,modal:!1,options:null,mode:"xs",svgString:null,srcdoc:null}},components:{BlockContainerPrvw:function(){return n.e("chunk-a214fd38").then(n.bind(null,"942f"))}},computed:Object(c["a"])(Object(c["a"])({},Object(a["b"])(["editor"])),{},{devMode:function(){return!0},classe:function(){return this.display?"visible":"hidden"},previewFrame:function(){var e=window.innerHeight<1024?.5:1;return"smartphone"===this.mode?this.orientation?"width:800px;height:375px;":"width:375px;height:80vh;":"tablet"===this.mode?this.orientation?"width:"+1024*e+"px;height:"+1366*e+"px;":"width:"+1366*e+"px;height:"+1024*e+"px;":void 0}}),watch:{mode:function(e){"tablet"===e||"smartphone"===e?window.localStorage.setItem("whoobe-preview-mode",!0):window.localStorage.setItem("whoobe-preview-mode",!1)}},methods:{contextmenu:function(e){e.preventDefault(),this.display=!0,this.$refs.contextMenu.style.top=e.clientY+"px",this.$refs.contextMenu.style.left=e.clientX+"px"},pageSettings:function(){u["modalBus"].$emit("blockSettings")},viewHTML:function(){var e=d.a.query(this.$store.state.editor.page.json.blocks,"$..blocks..font"),t=Object(r["a"])(new Set(e.filter((function(e){return e})))),n='<link rel="stylesheet" href="https://fonts.googleapis.com/css?family='+t.join("|")+'">',i='<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">\n',o=document.getElementById("content"),s=i+n+"\n"+o.outerHTML;s=s.replaceAll("http://localhost:3030/",""),s=this.$beautify(s.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]","")),this.options={lang:"html",content:s},this.modal=!0,u["modalBus"].$emit("viewHTML",this.options)},getHTML:function(){try{if(!this.srcdoc){var e='<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">\n',t=d.a.query(this.$store.state.editor.page.json.blocks,"$..blocks..font"),n=Object(r["a"])(new Set(t.filter((function(e){return e})))),i='<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">';n.length&&(i='<link rel="stylesheet" href="https://fonts.googleapis.com/css?family='+n.join("|")+'">');var o='<link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">',s='<link href="preview.css" rel="stylesheet">',c=document.getElementById("content"),a=e+o+"\n"+i+"\n"+s+"\n"+c.outerHTML;return a=a.replaceAll("http://localhost:3030/",""),a=this.$beautify(a.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]","")),this.srcdoc=a,a}return this.srcdoc}catch(l){console.log("Preview mode")}},buildPage:function(){var e=document.getElementById("content"),t=e.outerHTML;t=t.replaceAll("http://localhost:3030/",""),t=this.$beautify(t.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]","")),this.$exportBuild(t)},print:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$loading(),n=document.querySelector("#content"),i={type:"dataURL",useCORS:!0,scale:.5},t.next=5,e.$html2canvas(n,i);case 5:o=t.sent,e.printScreen=o,e.editor.page.image=o,e.$savePage(),e.$loading();case 10:case"end":return t.stop()}}),t)})))()},isprinted:function(){this.printScreen=!1},componentPrint:function(){this.$loading(!0),this.showContext=!1,this.$message("Print screen setup ..."),this.printScreen=!0},hideContextMenu:function(){this.$refs.contextMenu.style.opacity=0,this.$refs.contextMenu.style.left="-1000px"},showContext:function(e){console.log(e.clientY,e.clientX,screen.availWidth),e.preventDefault(),e.clientX<screen.availWidth-300?this.$refs.contextMenu.style.left=e.clientX-20+"px":this.$refs.contextMenu.style.left=e.clientX-300-20+"px",this.$refs.contextMenu.style.top=window.pageYOffset+e.clientY+"px",this.$refs.contextMenu.style.opacity=1},closeMe:function(){window.close()},size:function(e){window.screen.width=e},save:function(e){var t=this,n=JSON.parse(window.localStorage.getItem("whoobe-component"));e&&(n.image_uri=e.replace(".jpg",".webp"),n.image=e.replace(".jpg",".webp"),this.$api.service("components").patch(n._id,n).then((function(e){console.log("saved component => ",n,e),t.$action()})))},saveprint:function(){this.devMode?(this.$loading(!0),this.printMe()):this.$message("This option is available only in development mode")},printMe:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var i,o,s,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(i=e.length>0&&void 0!==e[0]?e[0]:"content",t.devMode){n.next=4;break}return t.$message("This option is available only in development mode"),n.abrupt("return");case 4:return o=document.querySelector("#"+i),o||document.querySelector(i),s={type:"dataURL",useCORS:!0,scale:.3},n.next=9,t.$html2canvas(o,s);case 9:r=n.sent,t.srcToFile(r,"w-preview-"+t.$mapState().editor.component.name.replaceAll(" ","")+".jpg","image/jpg").then((function(e){var n=new FormData;n.append("file",e),n.append("folder","preview"),n.append("isPreview",!0),n.append("thumbs",0),n.append("url","/uploads/preview/w-preview-"+t.$mapState().editor.component.name.replaceAll(" ","")+".jpg"),t.$http.post("upload/file",n,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){return console.log(e),r=e.data.url,t.save(r),t.$loading(),r})).catch((function(e){t.$loading(),t.$message("An error occured. Check your console log")}))}));case 11:case"end":return n.stop()}}),n)})))()},srcToFile:function(e,t,n){return Object(s["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.abrupt("return",fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],t,{type:n})})));case 1:case"end":return i.stop()}}),i)})))()}},mounted:function(){var e=this;if(this.$store.dispatch("preview",!0),this.doc=this.$store.state.editor.document,document.title="whoobe",document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.$dialogBus("closeDialog")})),this.mode=this.$attrs.options.mode,"fullscreen"!=this.mode){var t=document.createElement("style");t.textContent="body { overflow-y: auto; }",this.$refs.previewFrame.contentDocument.body.appendChild(t)}if(this.doc.data.javascript){var n=document.createElement("script");n.innerText=this.doc.data.javascript,document.body.appendChild(n)}}},h=p,m=n("2877"),f=Object(m["a"])(h,i,o,!1,null,null,null);t["default"]=f.exports}}]);