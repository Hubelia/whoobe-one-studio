(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c269b"],{"49cc":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"w-screen",on:{contextmenu:function(t){return e.contextmenu(t)}}},[n("div",{staticClass:"absolute top-0 left-0 h-10 w-full flex items-center justify-center text-gray-300 pr-8 cursor-pointer"},[n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"edit",title:"Edit"},on:{click:function(t){return e.openPage()}}}),n("i-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"dashicons:html",title:"HTML source"},on:{click:e.viewHTML}}),n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"laptop",title:"fullscreen"},on:{click:function(t){e.mode="fullscreen"}}}),n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"tablet",title:"tablet"},on:{click:function(t){e.mode="tablet"}}}),n("m-icon",{staticClass:"text-2xl  mr-4",attrs:{icon:"smartphone",title:"smartphone"},on:{click:function(t){e.mode="smartphone"}}}),"fullscreen"!=e.mode?n("m-icon",{staticClass:"text-2xl mr-4",attrs:{icon:"flip_camera_android",title:"Change orientation"},on:{click:function(t){e.orientation=!e.orientation}}}):e._e(),"tablet"===e.mode?n("div",{staticClass:"flex mx-2"},[n("button",{staticClass:"w-4 h-4 flex items-center text-xl justify-center rounded-l-lg bg-blue-400",on:{click:function(t){e.customZoom>.1&&(e.customZoom-=.1)}}},[e._v("-")]),n("div",{staticClass:"h-4 w-10 bg-white text-black flex items-center justify-center"},[e._v("zoom")]),n("button",{staticClass:"w-4 h-4 flex items-center text-xl justify-center rounded-r-lg bg-blue-400",on:{click:function(t){e.customZoom<1.1&&(e.customZoom+=.1)}}},[e._v("+")])]):e._e(),"fullscreen"!=e.mode?n("div",[e._v(e._s(e.currentSize))]):e._e()],1),"fullscreen"===e.mode?n("div",{staticClass:"flex flex-col overflow-y-auto overflow-x-hidden absolute inset-0 mt-10 laptop-view"},[e.doc?n("BlockContainerPrvw",{key:e.doc.id,ref:"content",attrs:{doc:e.doc,id:"content"}}):e._e()],1):e._e(),"fullscreen"!=e.mode?n("div",{staticClass:"text-center text-gray-300",class:"fullscreen"===e.mode?"hidden":""},[n("iframe",{ref:"previewFrame",staticClass:"m-auto border-8 overflow-x-hidden border-black rounded-xl",style:e.previewFrame,attrs:{id:"previewFrame",srcdoc:e.getHTML()}})]):e._e(),n("div",{ref:"contextMenu",staticClass:"fixed z-highest shadow bg-white shadow absolute flex flex-col w-64 cursor-pointer",class:e.classe,on:{mouseleave:function(t){e.display=!e.display}}},[n("div",{staticClass:"p-1 text-white bg-gray-800 flex items-center",on:{click:function(t){e.display=!e.display}}},[e._v(" Options "),n("div",{staticClass:"absolute right-0 mr-1 flex items-center"},[n("m-icon",{attrs:{icon:"close"},on:{click:function(t){e.display=!e.display}}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:function(t){return e.print()}}},[e._v(" Save "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"save"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.pageSettings}},[e._v(" Page settings "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"settings"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.viewHTML}},[e._v(" HTML "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"code"}})],1)]),n("div",{staticClass:"p-1 hover:bg-gray-200 flex items-center",on:{click:e.buildPage}},[e._v(" Build Page "),n("div",{staticClass:"absolute right-0 flex items-center pr-1"},[n("m-icon",{attrs:{icon:"build"}})],1)])]),e.svgString?n("div",[n("img",{attrs:{src:e.svgString}})]):e._e(),e.modal?n("Modal",{attrs:{topbar:!0,component:"blocks/components/BlockJSEditor.vue",options:e.options},on:{close:function(t){e.modal=!e.modal}}}):e._e()],1)},i=[],s=n("1da1"),c=n("2909"),r=n("5530"),a=(n("96cf"),n("d3b7"),n("3ca3"),n("ddb0"),n("b0c0"),n("6062"),n("4de4"),n("a15b"),n("ac1f"),n("5319"),n("2f62")),l=n("52cd"),u=n.n(l),d=n("56d7"),p={name:"BlockWindowPreview",data:function(){return{doc:null,showContextMenu:!1,showHtml:!1,printScreen:!1,editScreenshot:!0,orientation:!1,display:!1,modal:!1,options:null,mode:"xs",svgString:null,srcdoc:null,customZoom:.5,currentSize:null,htmlSource:null}},components:{BlockContainerPrvw:function(){return n.e("chunk-a214fd38").then(n.bind(null,"942f"))}},computed:Object(r["a"])(Object(r["a"])({},Object(a["b"])(["editor"])),{},{devMode:function(){return!0},classe:function(){return this.display?"visible":"hidden"},previewFrame:function(){return"smartphone"===this.mode?(this.orientation?this.currentSize="800x375":this.currentSize="375x800",this.orientation?"width:800px;height:375px;":"width:375px;height:80vh;"):"tablet"===this.mode?(this.orientation?this.currentSize=parseInt(1024*this.customZoom)+"x"+parseInt(1366*this.customZoom):this.currentSize=parseInt(1366*this.customZoom)+"x"+parseInt(1024*this.customZoom),this.orientation?"width:"+1024*this.customZoom+"px;height:"+1366*this.customZoom+"px;":"width:"+1366*this.customZoom+"px;height:"+1024*this.customZoom+"px;"):void 0}}),watch:{mode:function(e){"tablet"===e||"smartphone"===e?window.localStorage.setItem("whoobe-preview-mode",!0):window.localStorage.setItem("whoobe-preview-mode",!1)}},methods:{openPage:function(){this.$store.dispatch("add_tab",{label:this.$store.state.editor.page.name,object:this.$store.state.editor.page,type:"editor"}),this.$dialogBus("closeDialog")},contextmenu:function(e){e.preventDefault(),this.display=!0,this.$refs.contextMenu.style.top=e.clientY+"px",this.$refs.contextMenu.style.left=e.clientX+"px"},pageSettings:function(){d["modalBus"].$emit("blockSettings")},viewHTML:function(){var e=u.a.query(this.$store.state.editor.page.json.blocks,"$..blocks..font"),t=Object(c["a"])(new Set(e.filter((function(e){return e})))),n="";t.length&&(n='\x3c!--Google Fonts--\x3e\n<link rel="stylesheet" href="https://fonts.googleapis.com/css?family='+t.join("|")+'">');var o='\x3c!--Material-icons--\x3e\n<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">\n',i=document.getElementById("content"),s=i.outerHTML;s=this.$beautify(s.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]",""));var r=o+n+"\n"+s;this.options={lang:"html",content:r},d["modalBus"].$emit("viewHTML",this.options)},getHTML:function(){try{if(!this.srcdoc){var e='<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">\n',t=u.a.query(this.$store.state.editor.page.json.blocks,"$..blocks..font"),n=Object(c["a"])(new Set(t.filter((function(e){return e})))),o='<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">';o=n.length?'<link rel="stylesheet" href="https://fonts.googleapis.com/css?family='+n.join("|")+'">':"";var i='<link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">\n',s='<script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"><\/script>',r='<link href="preview.css" rel="stylesheet">',a=document.getElementById("content"),l=e+i+"\n"+o+"\n"+r+"\n"+a.outerHTML;return l=this.$beautify(l.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]","")),void(this.srcdoc=l+"\n"+s)}return this.srcdoc}catch(d){console.log(d),console.log("Preview mode error in creating source")}},buildPage:function(){var e=document.getElementById("content"),t=e.outerHTML;t=t.replaceAll("http://localhost:3030/",""),t=this.$beautify(t.replaceAll("\x3c!----\x3e","").replaceAll("[object Object]","")),this.$exportBuild(t)},print:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n,o,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$loading(),n=document.querySelector("#content"),o={type:"dataURL",useCORS:!0,scale:.5},t.next=5,e.$html2canvas(n,o);case 5:i=t.sent,e.printScreen=i,e.editor.page.image=i,e.$savePage(),e.$loading();case 10:case"end":return t.stop()}}),t)})))()},isprinted:function(){this.printScreen=!1},componentPrint:function(){this.$loading(!0),this.showContext=!1,this.$message("Print screen setup ..."),this.printScreen=!0},hideContextMenu:function(){this.$refs.contextMenu.style.opacity=0,this.$refs.contextMenu.style.left="-1000px"},showContext:function(e){console.log(e.clientY,e.clientX,screen.availWidth),e.preventDefault(),e.clientX<screen.availWidth-300?this.$refs.contextMenu.style.left=e.clientX-20+"px":this.$refs.contextMenu.style.left=e.clientX-300-20+"px",this.$refs.contextMenu.style.top=window.pageYOffset+e.clientY+"px",this.$refs.contextMenu.style.opacity=1},closeMe:function(){window.close()},size:function(e){window.screen.width=e},save:function(e){var t=this,n=JSON.parse(window.localStorage.getItem("whoobe-component"));e&&(n.image_uri=e.replace(".jpg",".webp"),n.image=e.replace(".jpg",".webp"),this.$api.service("components").patch(n._id,n).then((function(e){console.log("saved component => ",n,e),t.$action()})))},saveprint:function(){this.devMode?(this.$loading(!0),this.printMe()):this.$message("This option is available only in development mode")},printMe:function(){var e=arguments,t=this;return Object(s["a"])(regeneratorRuntime.mark((function n(){var o,i,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=e.length>0&&void 0!==e[0]?e[0]:"content",t.devMode){n.next=4;break}return t.$message("This option is available only in development mode"),n.abrupt("return");case 4:return i=document.querySelector("#"+o),i||document.querySelector(o),s={type:"dataURL",useCORS:!0,scale:.3},n.next=9,t.$html2canvas(i,s);case 9:c=n.sent,t.srcToFile(c,"w-preview-"+t.$mapState().editor.component.name.replaceAll(" ","")+".jpg","image/jpg").then((function(e){var n=new FormData;n.append("file",e),n.append("folder","preview"),n.append("isPreview",!0),n.append("thumbs",0),n.append("url","/uploads/preview/w-preview-"+t.$mapState().editor.component.name.replaceAll(" ","")+".jpg"),t.$http.post("upload/file",n,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){return console.log(e),c=e.data.url,t.save(c),t.$loading(),c})).catch((function(e){t.$loading(),t.$message("An error occured. Check your console log")}))}));case 11:case"end":return n.stop()}}),n)})))()},srcToFile:function(e,t,n){return Object(s["a"])(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.abrupt("return",fetch(e).then((function(e){return e.arrayBuffer()})).then((function(e){return new File([e],t,{type:n})})));case 1:case"end":return o.stop()}}),o)})))()}},mounted:function(){var e=this;if(this.$store.dispatch("preview",!0),this.doc=this.$store.state.editor.document,document.title="whoobe",document.addEventListener("keydown",(function(t){"Escape"===t.key&&e.$dialogBus("closeDialog")})),this.mode=this.$attrs.options.mode,"fullscreen"!=this.mode){var t=document.createElement("style");t.textContent="body { overflow-y: auto; }",this.$refs.previewFrame.contentDocument.body.appendChild(t)}if(this.doc.data.javascript){var n=document.createElement("script");n.innerText=this.doc.data.javascript,document.body.appendChild(n)}window.innerHeight<1024?this.customZoom=.5:this.customZoom=1}},m=p,h=n("2877"),f=Object(h["a"])(m,o,i,!1,null,null,null);t["default"]=f.exports}}]);